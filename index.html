<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HexLife Explorer (Worker)</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="app-container">
        <canvas id="hexGridCanvas"></canvas>
        <input type="file" id="fileInput" accept=".txt,.json" style="display: none;">
        <div id="ui-container">
            <div id="primary-controls-area">
                <div class="ui-group" id="group-title">
                    <span class="rule-display-wrapper"><code id="rulesetDisplay">N/A</code></span>
                </div>
                <div class="ui-group" id="group-playback">
                    <button id="playPauseButton" class="button">Play</button>
                    <div id="speedSliderMount"></div>
                </div>

                <div class="ui-group" id="group-brush">
                    <div id="neighborhoodSizeSliderMount"></div>
                </div>

                <div class="ui-group" id="group-ruleset">
                    <button id="randomRulesetButton" class="button">[N]ew Rules</button>
                    <div id="generateModeSwitch" class="three-way-switch" title="Select ruleset generation mode">
                        <input type="radio" id="genModeRandom" name="generateMode" value="random" class="radio-switch-input">
                        <label for="genModeRandom" class="radio-switch-label">Random</label>

                        <input type="radio" id="genModeNCount" name="generateMode" value="n_count" class="radio-switch-input">
                        <label for="genModeNCount" class="radio-switch-label">N-Count</label>

                        <input type="radio" id="genModeRSym" name="generateMode" value="r_sym" class="radio-switch-input" checked>
                        <label for="genModeRSym" class="radio-switch-label">R-Sym</label>
                    </div>
                    <div class="bias-controls">
                        <input type="checkbox" id="useCustomBiasCheckbox" class="checkbox-input">
                        <label for="useCustomBiasCheckbox" class="checkbox-label">Bias:</label>
                        <div id="biasSliderMount"></div>
                    </div>
                    <div class="ruleset-scope-switch" title="Scope for new/set ruleset">
                        <input type="checkbox" id="rulesetScopeSwitch" class="checkbox-input" checked>
                        <label for="rulesetScopeSwitch" class="checkbox-label scope-label" data-on-text="All Worlds" data-off-text="Selected World">All Worlds</label>
                    </div>
                    <input type="checkbox" id="resetOnNewRuleCheckbox" class="checkbox-input"
                        title="Reset world(s) when generating or setting a new ruleset from this bar" checked>
                    <label for="resetOnNewRuleCheckbox" class="checkbox-label">Auto-Reset</label>
                </div>
                <div class="ui-group" id="group-ruleset-input">
                    <button id="copyRuleButton" class="button" title="Copy current ruleset hex code">Copy</button>
                    <input type="text" id="rulesetInput" class="hex-input" placeholder="32 hex chars">
                    <button id="setRuleButton" class="button">Set</button>
                    <button id="editRuleButton" class="button"
                        title="[E] Show visual editor for the current ruleset">[E]dit</button>
                </div>
                <div class="ui-group" id="group-state">
                    <button id="saveStateButton" class="button" title="Save current grid state">Save</button>
                    <button id="loadStateButton" class="button"
                        title="Load grid state from .json/.txt file">Load</button>
                    <button id="resetCurrentButton" class="button"
                        title="[R] Reset current world to initial density">[R]eset Current</button>
                    <button id="resetAllButtonNew" class="button" title="Reset all worlds to initial densities">Reset All</button>
                    <button id="clearCurrentButton" class="button"
                        title="[C] Clear current world (0s or 1s)">[C]lear Current</button>
                    <button id="clearAllButton" class="button" title="Clear all enabled worlds (0s or 1s)">Clear All</button>
                    <button id="setupPanelButton" class="button" title="[S] Open world setup panel">[S]etup</button>
                    <button id="analysisPanelButton" class="button" title="[A] Open analysis panel">Analyse</button>
                </div>
            </div>

            <div id="status-info-area">
                <div class="ui-group" id="stats-content">
                    <div>Tick: <span id="stat-tick">--</span></div> <div>Ratio: <span id="stat-ratio">--</span>%</div>
                    <div>Avg: <span id="stat-avg-ratio">--</span>%</div>
                </div>
                <div class="ui-group" id="group-performance">
                    <div>FPS: <span id="stat-fps">--</span></div>
                    <div>TPS: <span id="stat-actual-tps">--</span></div>
                </div>
            </div>
        </div>

        <div id="rulesetEditorPanel" class="draggable-panel-base hidden">
            <button id="closeEditorButton" class="close-panel-button" title="Close Panel">&times;</button>
            <h3>Ruleset Editor</h3>
            <div class="editor-controls">
                <input type="text" id="editorRulesetInput" class="editor-hex-input"
                    placeholder="32 hex chars (e.g., FFFFFF...000000)"
                    title="Current ruleset hex code. Edit and press Enter or click away to apply.">
                <button id="clearRulesButton" class="button"
                    title="Set all rules to inactive, or active if all are already inactive">Clear/Fill</button>
                <select id="rulesetEditorMode" title="Choose editor mode">
                    <option value="detailed">Detailed (128 rules)</option>
                    <option value="neighborCount">Neighbor Count (14 groups)</option>
                    <option value="rotationalSymmetry" selected>Rotational Symmetry (28 groups)</option>
                </select>
            </div>
            <div class="editor-apply-scope-controls">
                <label>Apply Changes To:</label>
                <div class="radio-group">
                    <input type="radio" id="editorApplyScopeSelected" name="editorApplyScope" value="selected" class="radio-switch-input" checked>
                    <label for="editorApplyScopeSelected" class="radio-switch-label">Selected World</label>
                    <input type="radio" id="editorApplyScopeAll" name="editorApplyScope" value="all" class="radio-switch-input">
                    <label for="editorApplyScopeAll" class="radio-switch-label">All Worlds</label>
                </div>
                <div class="editor-auto-reset-control">
                    <input type="checkbox" id="editorAutoResetCheckbox" class="checkbox-input" checked>
                    <label for="editorAutoResetCheckbox" class="checkbox-label">Auto-Reset on Change</label>
                </div>
            </div>
            <div class="panel-content-area">
                <div id="rulesetEditorGrid" class="hidden"></div>
                <div id="neighborCountRulesetEditorGrid" class="hidden"></div>
                <div id="rotationalSymmetryRulesetEditorGrid"></div>
                <div class="editor-text">
                    <p>This editor modifies the ruleset of the currently selected world. Use "Apply Changes To" to propagate these changes to all worlds.</p>
                    <p>Each group shows a possible neighborhood configuration (center hex + 6 neighbors).</p>
                    <p>The smaller inner hexagon shows the resulting state of the center cell in the <em>next</em> step.
                    </p>
                    <p>Click on a rule's inner hexagon (Detailed), the whole visualization (Neighbor Count), or the canonical pattern (Rotational Symmetry) to toggle its output state(s).
                       For Rotational Symmetry mode, you define rules for 14 canonical neighborhood shapes (plus center cell state). The "Orbit Size" shown indicates how many of the 128 fundamental rules are affected by that single setting.
                    </p>
                    <div class="editor-text-rules">
                        <p><span class="inline-hex state-0"><span class="inline-hex-inner state-0"></span></span> stays
                            inactive</p>
                        <p><span class="inline-hex state-0"><span class="inline-hex-inner state-1"></span></span>
                            becomes active</p>
                        <p><span class="inline-hex state-1"><span class="inline-hex-inner state-0"></span></span>
                            becomes inactive</p>
                        <p><span class="inline-hex state-1"><span class="inline-hex-inner state-1"></span></span> stays
                            active</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="setupPanel" class="draggable-panel-base hidden">
            <button id="closeSetupPanelButton" class="close-panel-button" title="Close Panel">&times;</button>
            <h3>World Setup</h3>
            <div class="panel-content-area">
                <p class="editor-text info-text">Configure initial density and enable/disable individual worlds. Click "Use Main Ruleset" to apply the selected world's (main view) ruleset to a specific world here and reset it. "Apply & Reset All Worlds" re-initializes all worlds with their current density/enabled settings using their respective current rulesets.</p>
                <div id="worldSetupGrid" class="world-config-grid">
                    </div>
                <div class="panel-actions">
                    <button id="applySetupButton" class="button">Apply & Reset All Worlds</button>
                </div>
            </div>
        </div>
        <div id="analysisPanel" class="draggable-panel-base hidden">
            <button id="closeAnalysisPanelButton" class="close-panel-button" title="Close Panel">&times;</button>
            <h3>Analysis Tools</h3>
            <div class="panel-content-area"> <div class="settings-group"> <label for="enableEntropySamplingCheckbox">Enable Entropy Sampling:</label>
                    <input type="checkbox" id="enableEntropySamplingCheckbox" class="checkbox-input">
                     <label for="enableEntropySamplingCheckbox" class="checkbox-label">Enabled</label>
                </div>
                <div class="settings-group" id="entropySampleRateSliderMount">
                    </div>
                <div class="stats-display"> Current Sampled Entropy: <span id="stat-entropy">N/A</span>
                </div>

                <div class="plugins-mount-area">
                </div>
            </div>
        </div>
    </div>
    <script type="module" src="src/main.js"></script>
</body>

</html>