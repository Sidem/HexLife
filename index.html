<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HexLife Explorer</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="app-container">
        <canvas id="hexGridCanvas"></canvas>
        <input type="file" id="fileInput" accept=".txt,.json" style="display: none;">
        <div id="ui-container">
            <div id="primary-controls-area">
                <div class="ui-group" id="group-title">
                    <span class="rule-display-wrapper"><code id="rulesetDisplay">N/A</code></span>
                </div>
                <div class="ui-group" id="group-playback">
                    <button id="playPauseButton" class="button">Play</button>
                    <div id="speedSliderMount"></div>
                </div>

                <div class="ui-group" id="group-brush">
                    <div id="neighborhoodSizeSliderMount"></div>
                </div>

                <div class="ui-group" id="group-ruleset">
                    <button id="randomRulesetButton" class="button">[N]ew Rules</button>
                    <input type="checkbox" id="generateSymmetricalCheckbox" class="checkbox-input"
                        title="Generate rules symmetrically (based on neighbor count)" checked>
                    <label for="generateSymmetricalCheckbox" class="checkbox-label sym-label">Symmetrical</label>
                    <div class="bias-controls">
                        <input type="checkbox" id="useCustomBiasCheckbox" class="checkbox-input">
                        <label for="useCustomBiasCheckbox" class="checkbox-label">Bias:</label>
                        <div id="biasSliderMount"></div>
                    </div>
                    <input type="checkbox" id="resetOnNewRuleCheckbox" class="checkbox-input"
                        title="Reset all world states when generating a new ruleset" checked>
                    <label for="resetOnNewRuleCheckbox" class="checkbox-label">Auto-Reset</label>
                </div>
                <div class="ui-group" id="group-ruleset-input">
                    <button id="copyRuleButton" class="button" title="Copy current ruleset hex code">Copy</button>
                    <input type="text" id="rulesetInput" class="hex-input" placeholder="32 hex chars">
                    <button id="setRuleButton" class="button">Set</button>
                    <button id="editRuleButton" class="button"
                        title="[E] Show visual editor for the current ruleset">[E]dit</button>
                </div>
                <div class="ui-group" id="group-state">
                    <button id="saveStateButton" class="button" title="Save current grid state">Save</button>
                    <button id="loadStateButton" class="button"
                        title="Load grid state from .json/.txt file">Load</button>
                    <button id="resetStatesButton" class="button"
                        title="[R] Reset all worlds to initial densities">[R]eset All</button>
                    <button id="setupPanelButton" class="button" title="[S] Open world setup panel">[S]etup</button>
                    <button id="analysisPanelButton" class="button" title="[A] Open analysis panel">Analyse</button>
                </div>
            </div>

            <div id="status-info-area">
                <div class="ui-group" id="stats-content">
                    <div>Ratio: <span id="stat-ratio">--</span>%</div>
                    <div>Avg: <span id="stat-avg-ratio">--</span>%</div>
                </div>
                <div class="ui-group" id="group-performance">
                    <div>FPS: <span id="stat-fps">--</span></div>
                    <div>TPS: <span id="stat-actual-tps">--</span></div>
                </div>
            </div>
        </div>

        <div id="rulesetEditorPanel" class="draggable-panel-base hidden">
            <button id="closeEditorButton" class="close-panel-button" title="Close Panel">&times;</button>
            <h3>Ruleset Editor</h3>
            <div class="editor-controls">
                <input type="text" id="editorRulesetInput" class="editor-hex-input"
                    placeholder="32 hex chars (e.g., FFFFFF...000000)"
                    title="Current ruleset hex code. Edit and press Enter or click away to apply.">
                <button id="clearRulesButton" class="button"
                    title="Set all rules to inactive, or active if all are already inactive">Clear/Fill</button>
                <select id="rulesetEditorMode" title="Choose editor mode">
                    <option value="detailed" selected>Detailed (128 rules)</option>
                    <option value="neighborCount">Neighbor Count (14 rules)</option>
                </select>
            </div>
            <div class="editor-content-area">
                <div id="rulesetEditorGrid"></div>
                <div id="neighborCountRulesetEditorGrid" class="hidden"></div>
                <div class="editor-text">
                    <p>Each group shows a possible neighborhood configuration (center hex + 6 neighbors).</p>
                    <p>The smaller inner hexagon shows the resulting state of the center cell in the <em>next</em> step.
                    </p>
                    <p>Click on a rule's inner hexagon (Detailed) or the whole visualization (Neighbor Count) to toggle
                        its output state.</p>
                    <div class="editor-text-rules">
                        <p><span class="inline-hex state-0"><span class="inline-hex-inner state-0"></span></span> stays
                            inactive</p>
                        <p><span class="inline-hex state-0"><span class="inline-hex-inner state-1"></span></span>
                            becomes active</p>
                        <p><span class="inline-hex state-1"><span class="inline-hex-inner state-0"></span></span>
                            becomes inactive</p>
                        <p><span class="inline-hex state-1"><span class="inline-hex-inner state-1"></span></span> stays
                            active</p>
                    </div>
                </div>
            </div>
        </div>
        <div id="setupPanel" class="draggable-panel-base hidden">
            <button id="closeSetupPanelButton" class="close-panel-button" title="Close Panel">&times;</button>
            <h3>World Setup</h3>
            <div class="panel-content-area">
                <p class="editor-text info-text">Configure initial density and enable/disable individual worlds. Changes
                    are saved automatically. Click "Apply & Reset" to re-initialize all worlds with the current
                    settings.</p>
                <div id="worldSetupGrid" class="world-config-grid"></div>
                <div class="panel-actions">
                    <button id="applySetupButton" class="button">Apply & Reset Worlds</button>
                </div>
            </div>
        </div>
        <div id="analysisPanel" class="draggable-panel-base hidden">
            <button id="closeAnalysisPanelButton" class="close-panel-button" title="Close Panel">&times;</button>
            <h3>Analysis Tools</h3>
            <div class="panel-content-area">
                <p class="editor-text info-text">Analysis for the currently selected world. Enable sampling for live plots.</p>
                <div class="analysis-controls">
                    <div class="sampling-control">
                        <input type="checkbox" id="enableEntropySamplingCheckbox" class="checkbox-input">
                        <label for="enableEntropySamplingCheckbox" class="checkbox-label">Sample Continuously</label>
                    </div>
                    <div id="entropySampleRateSliderMount"></div>
                    <div class="entropy-display">
                        Current Entropy: <span id="stat-entropy">N/A</span>
                    </div>
                </div>

                <div class="plot-container">
                    <label for="ratioPlotCanvas">Activity Ratio History (0.0 to 1.0)</label>
                    <canvas id="ratioPlotCanvas" width="400" height="100"></canvas>
                </div>
                 <div class="plot-container">
                     <label for="entropyPlotCanvas">Sampled Entropy History (0.0 to 1.0)</label>
                     <canvas id="entropyPlotCanvas" width="400" height="100"></canvas>
                 </div>
            </div>
        </div>
    </div>
    <script type="module" src="src/main.js"></script>
</body>

</html>